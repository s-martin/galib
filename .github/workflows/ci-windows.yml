name: CI-Windows

on: [push]

jobs:
  build:

    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    - name: Download and install Boost
      # You may pin to the exact commit or the version.
     # uses: MarkusJx/install-boost@d175e516e6d321b68ff67afecf7da5e7c53c16f7
      uses: MarkusJx/install-boost@v2.4.3
      with:
          # The boost version to install, e.g. "1.73.0"
          boost_version: 1.80.0
          toolset: msvc 
          platform_version: 2022 
          # Whether the boost libraries are linked statically or dynamically
          # link: # optional, default is 
          # The architecture the binaries were built for
          arch: aarch64
          # The dirctory to install boost into
          # boost_install_dir: # optional, default is 
          # Wheter to use actions/cache to improve build times
          cache: true
    - name: Configure CMake
      run: cmake -B ${{ env.build }}
        -DBoost_INCLUDE_DIR=${{steps.install-boost.outputs.BOOST_ROOT}}/include 
        -DBoost_LIBRARY_DIRS=${{steps.install-boost.outputs.BOOST_ROOT}}/lib
      env:
        BOOST_ROOT: ${{ steps.install-boost.outputs.BOOST_ROOT }}
    #- name: install dependencies
    #  run: vcpkg install boost-test boost-program-options boost-predef --triplet x64-windows
    #- name: cmake config
    #  run: |
    #    md build
    #    cd build
    #    cmake ../ -DCMAKE_TOOLCHAIN_FILE=C:/vcpkg/scripts/buildsystems/vcpkg.cmake
    - name: make
      run: cmake --build ./build
    - name: run unit tests
      working-directory: ./build
      run: ./test/Debug/GAlibTest.exe
